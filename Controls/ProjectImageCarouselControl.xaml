<UserControl
    x:Class="ResumeApp.Controls.ProjectImageCarouselControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    x:Name="mProjectImageCarouselControlRoot"
    Focusable="True"
    KeyboardNavigation.TabNavigation="Local"
    PreviewKeyDown="OnRootPreviewKeyDown"
    PreviewMouseLeftButtonDown="OnRootPreviewMouseLeftButtonDown"
    PreviewMouseWheel="OnRootPreviewMouseWheel"
    SnapsToDevicePixels="True"
    UseLayoutRounding="True">

    <UserControl.Resources>
        <Style x:Key="NavigationButtonStyle" TargetType="{x:Type Button}">
            <Setter Property="Width" Value="38" />
            <Setter Property="Height" Value="38" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="Background" Value="{DynamicResource CommonBlackBrush}" />
            <Setter Property="BorderBrush" Value="{DynamicResource CommonGrayBrush}" />
            <Setter Property="BorderThickness" Value="{StaticResource ExtraSmallThickness}" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border
                            x:Name="mNavigationButtonBorder"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="999"
                            SnapsToDevicePixels="True">
                            <ContentPresenter
                                Margin="{TemplateBinding Padding}"
                                HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="mNavigationButtonBorder" Property="BorderBrush" Value="{DynamicResource CommonBrush}" />
                                <Setter Property="Opacity" Value="0.75" />
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Opacity" Value="0.95" />
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.15" />
                            </Trigger>
                            <Trigger Property="IsKeyboardFocused" Value="True">
                                <Setter TargetName="mNavigationButtonBorder" Property="BorderBrush" Value="{DynamicResource CommonBrush}" />
                                <Setter Property="Opacity" Value="0.85" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style
            x:Key="ExpandButtonStyle"
            BasedOn="{StaticResource NavigationButtonStyle}"
            TargetType="{x:Type Button}">
            <Setter Property="Width" Value="36" />
            <Setter Property="Height" Value="36" />
            <Setter Property="Margin" Value="12" />
            <Setter Property="HorizontalAlignment" Value="Right" />
            <Setter Property="VerticalAlignment" Value="Top" />
            <Setter Property="Opacity" Value="0" />
            <Setter Property="IsHitTestVisible" Value="False" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsMouseOver, ElementName=mProjectImageCarouselControlRoot}" Value="True">
                    <Setter Property="Opacity" Value="1" />
                    <Setter Property="IsHitTestVisible" Value="True" />
                </DataTrigger>
                <DataTrigger Binding="{Binding IsKeyboardFocusWithin, ElementName=mProjectImageCarouselControlRoot}" Value="True">
                    <Setter Property="Opacity" Value="1" />
                    <Setter Property="IsHitTestVisible" Value="True" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="DotsListBoxItemStyle" TargetType="{x:Type ListBoxItem}">
            <Setter Property="Width" Value="10" />
            <Setter Property="Height" Value="10" />
            <Setter Property="Margin" Value="4,4,4,4" />
            <Setter Property="Focusable" Value="False" />
            <Setter Property="Cursor" Value="Hand" />
            <EventSetter Event="PreviewMouseLeftButtonDown" Handler="OnDotPreviewMouseLeftButtonDown" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ListBoxItem}">
                        <Border
                            x:Name="mDotBorder"
                            Background="{DynamicResource CommonWhiteBrush}"
                            CornerRadius="999"
                            Opacity="0.35"
                            RenderTransformOrigin="0.5,0.5"
                            SnapsToDevicePixels="True">
                            <Border.RenderTransform>
                                <ScaleTransform x:Name="mDotScaleTransform" ScaleX="1" ScaleY="1" />
                            </Border.RenderTransform>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation
                                                Storyboard.TargetName="mDotScaleTransform"
                                                Storyboard.TargetProperty="ScaleX"
                                                To="1.35"
                                                Duration="0:0:0.12">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation
                                                Storyboard.TargetName="mDotScaleTransform"
                                                Storyboard.TargetProperty="ScaleY"
                                                To="1.35"
                                                Duration="0:0:0.12">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation
                                                Storyboard.TargetName="mDotScaleTransform"
                                                Storyboard.TargetProperty="ScaleX"
                                                To="1"
                                                Duration="0:0:0.16">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation
                                                Storyboard.TargetName="mDotScaleTransform"
                                                Storyboard.TargetProperty="ScaleY"
                                                To="1"
                                                Duration="0:0:0.16">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                                <Setter TargetName="mDotBorder" Property="Opacity" Value="0.7" />
                            </Trigger>

                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="mDotBorder" Property="Background" Value="{DynamicResource CommonBrush}" />
                                <Setter TargetName="mDotBorder" Property="Opacity" Value="0.9" />
                            </Trigger>

                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsSelected" Value="True" />
                                    <Condition Property="IsMouseOver" Value="True" />
                                </MultiTrigger.Conditions>
                                <Setter TargetName="mDotBorder" Property="Opacity" Value="1" />
                            </MultiTrigger>

                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="mDotBorder" Property="Opacity" Value="0.15" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PlaceholderTextBlockStyle" TargetType="{x:Type TextBlock}">
            <Setter Property="Foreground" Value="{DynamicResource CommonWhiteBrush}" />
            <Setter Property="FontSize" Value="{StaticResource SmallFontSize}" />
            <Setter Property="Opacity" Value="{StaticResource CommonOpacity}" />
            <Setter Property="TextAlignment" Value="Center" />
            <Setter Property="TextWrapping" Value="Wrap" />
        </Style>
    </UserControl.Resources>

    <Grid x:Name="mCarouselLayoutRoot">
        <Border x:Name="mMediaCardBorder" SnapsToDevicePixels="True">
            <Border.Style>
                <Style TargetType="{x:Type Border}">
                    <Setter Property="Height" Value="360" />
                    <Setter Property="CornerRadius" Value="{StaticResource ExtraSmallCornerRadius}" />
                    <Setter Property="Background">
                        <Setter.Value>
                            <SolidColorBrush Opacity="0.5" Color="{DynamicResource CommonGrayColor}" />
                        </Setter.Value>
                    </Setter>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsFullscreen, ElementName=mProjectImageCarouselControlRoot}" Value="True">
                            <Setter Property="Height" Value="{x:Static sys:Double.NaN}" />
                            <Setter Property="CornerRadius" Value="0" />
                            <Setter Property="Background" Value="Transparent" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>

            <Grid
                x:Name="mMediaRootGrid"
                ClipToBounds="True"
                SizeChanged="OnMediaRootGridSizeChanged"
                SnapsToDevicePixels="True">

                <Image
                    x:Name="mCurrentImageImage"
                    Opacity="0"
                    RenderOptions.BitmapScalingMode="HighQuality"
                    Stretch="Uniform" />

                <Button
                    x:Name="mExpandButton"
                    Click="OnExpandButtonClick"
                    Style="{StaticResource ExpandButtonStyle}">
                    <Viewbox
                        Width="16"
                        Height="16"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Stretch="Uniform">
                        <Grid
                            x:Name="mExpandIconGrid"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                            <Path
                                x:Name="mExpandIconPath"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Data="M4,9 V4 H9 M15,4 H20 V9 M20,15 V20 H15 M9,20 H4 V15"
                                Stroke="{DynamicResource CommonWhiteBrush}"
                                StrokeLineJoin="Round"
                                StrokeThickness="2" />
                        </Grid>
                    </Viewbox>
                </Button>

                <Grid x:Name="mPlaceholderGrid" Visibility="Collapsed">
                    <StackPanel
                        x:Name="mPlaceholderStackPanel"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center">

                        <Viewbox
                            x:Name="mPlaceholderIconViewbox"
                            Width="34"
                            Height="34">
                            <Path
                                x:Name="mPlaceholderIconPath"
                                Fill="{DynamicResource CommonWhiteBrush}"
                                Data="M2,5 C2,3.343 3.343,2 5,2 H19 C20.657,2 22,3.343 22,5 V19 C22,20.657 20.657,22 19,22 H5 C3.343,22 2,20.657 2,19 Z M6,7 A2,2 0 1 0 6,3 A2,2 0 1 0 6,7 Z M4,19 H20 V16 L16,12 L12,16 L9,13 Z"
                                Opacity="{StaticResource LowOpacity}" />
                        </Viewbox>

                        <TextBlock
                            x:Name="mPlaceholderTextBlock"
                            Margin="{StaticResource SmallThickness}"
                            Style="{StaticResource PlaceholderTextBlockStyle}"
                            Text="{Binding PlaceholderText, ElementName=mProjectImageCarouselControlRoot}" />
                    </StackPanel>
                </Grid>

                <Grid x:Name="mNavigationOverlayGrid" Visibility="Collapsed">
                    <Grid.Style>
                        <Style TargetType="{x:Type Grid}">
                            <Setter Property="Opacity" Value="0.4" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsMouseOver, ElementName=mMediaRootGrid}" Value="True">
                                    <Setter Property="Opacity" Value="1" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding IsKeyboardFocusWithin, ElementName=mProjectImageCarouselControlRoot}" Value="True">
                                    <Setter Property="Opacity" Value="1" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <Button
                        x:Name="mPreviousButton"
                        Margin="12,0,0,0"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        Click="OnPreviousButtonClick"
                        Style="{StaticResource NavigationButtonStyle}">
                        <Path
                            Width="15"
                            Fill="{DynamicResource CommonWhiteBrush}"
                            Data="M17.920015,8.074995 H11.690015 H6.079985 C5.119985,8.074995 4.639985,9.234995 5.319985,9.915005 L10.500015,15.095005 C11.330015,15.925005 12.680015,15.925005 13.510015,15.095005 L15.480015,13.125005 L18.690015,9.915005 C19.360015,9.234995 18.880015,8.074995 17.920015,8.074995 Z"
                            RenderTransformOrigin="0.5,0.5"
                            Stretch="Uniform">
                            <Path.RenderTransform>
                                <RotateTransform Angle="90" />
                            </Path.RenderTransform>
                        </Path>
                    </Button>

                    <Button
                        x:Name="mNextButton"
                        Grid.Column="2"
                        Margin="0,0,12,0"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Click="OnNextButtonClick"
                        Style="{StaticResource NavigationButtonStyle}">
                        <Path
                            Width="15"
                            Fill="{DynamicResource CommonWhiteBrush}"
                            Data="M17.920015,8.074995 H11.690015 H6.079985 C5.119985,8.074995 4.639985,9.234995 5.319985,9.915005 L10.500015,15.095005 C11.330015,15.925005 12.680015,15.925005 13.510015,15.095005 L15.480015,13.125005 L18.690015,9.915005 C19.360015,9.234995 18.880015,8.074995 17.920015,8.074995 Z"
                            RenderTransformOrigin="0.5,0.5"
                            Stretch="Uniform">
                            <Path.RenderTransform>
                                <RotateTransform Angle="270" />
                            </Path.RenderTransform>
                        </Path>
                    </Button>

                    <Border
                        x:Name="mDotsBackgroundBorder"
                        Grid.ColumnSpan="3"
                        Margin="0,0,0,10"
                        Padding="10,6"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Bottom"
                        Background="{DynamicResource CommonBlackBrush}"
                        CornerRadius="{StaticResource CommonCornerRadius}"
                        Opacity="0.25"
                        SnapsToDevicePixels="True">
                        <ListBox
                            x:Name="mDotsListBox"
                            Background="Transparent"
                            BorderThickness="0"
                            Focusable="False"
                            ItemsSource="{Binding Images, ElementName=mProjectImageCarouselControlRoot}"
                            ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                            ScrollViewer.VerticalScrollBarVisibility="Disabled"
                            SelectedIndex="{Binding SelectedIndex, ElementName=mProjectImageCarouselControlRoot, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <ListBox.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <StackPanel x:Name="mDotsStackPanel" Orientation="Horizontal" />
                                </ItemsPanelTemplate>
                            </ListBox.ItemsPanel>
                            <ListBox.ItemContainerStyle>
                                <Style BasedOn="{StaticResource DotsListBoxItemStyle}" TargetType="{x:Type ListBoxItem}" />
                            </ListBox.ItemContainerStyle>
                        </ListBox>
                    </Border>
                </Grid>

                <Border
                    x:Name="mFocusRingBorder"
                    BorderBrush="{DynamicResource CommonBrush}"
                    BorderThickness="{StaticResource ExtraSmallThickness}"
                    CornerRadius="{Binding CornerRadius, ElementName=mMediaCardBorder}"
                    IsHitTestVisible="False"
                    Opacity="0"
                    SnapsToDevicePixels="True">
                    <Border.Style>
                        <Style TargetType="{x:Type Border}">
                            <Setter Property="Opacity" Value="0" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsKeyboardFocusWithin, ElementName=mProjectImageCarouselControlRoot}" Value="True">
                                    <Setter Property="Opacity" Value="0.9" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                </Border>
            </Grid>
        </Border>
    </Grid>
</UserControl>
