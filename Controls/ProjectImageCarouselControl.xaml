<!--  Copyright (C) Olivier La Haye  -->
<!--  All rights reserved.  -->

<UserControl
    x:Class="ResumeApp.Controls.ProjectImageCarouselControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    x:Name="mProjectImageCarouselControlRoot"
    Focusable="True"
    KeyboardNavigation.TabNavigation="Local"
    LostMouseCapture="OnRootLostMouseCapture"
    PreviewMouseLeftButtonDown="OnRootPreviewMouseLeftButtonDown"
    PreviewMouseLeftButtonUp="OnRootPreviewMouseLeftButtonUp"
    PreviewMouseMove="OnRootPreviewMouseMove"
    PreviewMouseWheel="OnRootPreviewMouseWheel"
    SnapsToDevicePixels="True"
    UseLayoutRounding="True">

    <UserControl.Resources>
        <Style x:Key="ButtonStyle" TargetType="{x:Type Button}">
            <Setter Property="Width" Value="38" />
            <Setter Property="Height" Value="38" />
            <Setter Property="Padding" Value="0" />
            <Setter Property="Background" Value="{DynamicResource CommonDarkerGrayBrush}" />
            <Setter Property="HorizontalContentAlignment" Value="Center" />
            <Setter Property="VerticalContentAlignment" Value="Center" />
            <Setter Property="VerticalAlignment" Value="Center" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border
                            x:Name="mNavigationButtonBorder"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="999"
                            RenderTransformOrigin="0.5,0.5"
                            SnapsToDevicePixels="True">
                            <Border.RenderTransform>
                                <ScaleTransform x:Name="mNavigationButtonScaleTransform" ScaleX="1" ScaleY="1" />
                            </Border.RenderTransform>

                            <ContentPresenter
                                Margin="{TemplateBinding Padding}"
                                HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                VerticalAlignment="{TemplateBinding VerticalContentAlignment}" />
                        </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation
                                                Storyboard.TargetName="mNavigationButtonScaleTransform"
                                                Storyboard.TargetProperty="ScaleX"
                                                To="1.06"
                                                Duration="0:0:0.12">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation
                                                Storyboard.TargetName="mNavigationButtonScaleTransform"
                                                Storyboard.TargetProperty="ScaleY"
                                                To="1.06"
                                                Duration="0:0:0.12">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>

                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation
                                                Storyboard.TargetName="mNavigationButtonScaleTransform"
                                                Storyboard.TargetProperty="ScaleX"
                                                To="1"
                                                Duration="0:0:0.16">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation
                                                Storyboard.TargetName="mNavigationButtonScaleTransform"
                                                Storyboard.TargetProperty="ScaleY"
                                                To="1"
                                                Duration="0:0:0.16">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>

                                <Setter TargetName="mNavigationButtonBorder" Property="BorderBrush" Value="{DynamicResource CommonBrush}" />
                                <Setter Property="Opacity" Value="1" />
                            </Trigger>

                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Opacity" Value="1" />
                            </Trigger>

                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Opacity" Value="0.15" />
                            </Trigger>

                            <Trigger Property="IsKeyboardFocused" Value="True">
                                <Setter TargetName="mNavigationButtonBorder" Property="BorderBrush" Value="{DynamicResource CommonBrush}" />
                                <Setter Property="Opacity" Value="1" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DotsListBoxItemStyle" TargetType="{x:Type ListBoxItem}">
            <Setter Property="Width" Value="10" />
            <Setter Property="Height" Value="10" />
            <Setter Property="Margin" Value="4,4,4,4" />
            <Setter Property="Focusable" Value="False" />
            <Setter Property="Cursor" Value="Hand" />
            <EventSetter Event="PreviewMouseLeftButtonDown" Handler="OnDotPreviewMouseLeftButtonDown" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ListBoxItem}">
                        <Border
                            x:Name="mDotBorder"
                            Background="{DynamicResource CommonWhiteBrush}"
                            CornerRadius="999"
                            Opacity="0.88"
                            RenderTransformOrigin="0.5,0.5"
                            SnapsToDevicePixels="True">
                            <Border.RenderTransform>
                                <ScaleTransform x:Name="mDotScaleTransform" ScaleX="1" ScaleY="1" />
                            </Border.RenderTransform>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation
                                                Storyboard.TargetName="mDotScaleTransform"
                                                Storyboard.TargetProperty="ScaleX"
                                                To="1.35"
                                                Duration="0:0:0.12">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation
                                                Storyboard.TargetName="mDotScaleTransform"
                                                Storyboard.TargetProperty="ScaleY"
                                                To="1.35"
                                                Duration="0:0:0.12">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <DoubleAnimation
                                                Storyboard.TargetName="mDotScaleTransform"
                                                Storyboard.TargetProperty="ScaleX"
                                                To="1"
                                                Duration="0:0:0.16">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                            <DoubleAnimation
                                                Storyboard.TargetName="mDotScaleTransform"
                                                Storyboard.TargetProperty="ScaleY"
                                                To="1"
                                                Duration="0:0:0.16">
                                                <DoubleAnimation.EasingFunction>
                                                    <CubicEase EasingMode="EaseOut" />
                                                </DoubleAnimation.EasingFunction>
                                            </DoubleAnimation>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                                <Setter TargetName="mDotBorder" Property="Opacity" Value="0.95" />
                            </Trigger>

                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="mDotBorder" Property="Background" Value="{DynamicResource CommonBrush}" />
                                <Setter TargetName="mDotBorder" Property="Opacity" Value="1" />
                            </Trigger>

                            <MultiTrigger>
                                <MultiTrigger.Conditions>
                                    <Condition Property="IsSelected" Value="True" />
                                    <Condition Property="IsMouseOver" Value="True" />
                                </MultiTrigger.Conditions>
                                <Setter TargetName="mDotBorder" Property="Opacity" Value="1" />
                            </MultiTrigger>

                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="mDotBorder" Property="Opacity" Value="0.35" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PlaceholderTextBlockStyle" TargetType="{x:Type TextBlock}">
            <Setter Property="Foreground" Value="{DynamicResource CommonWhiteBrush}" />
            <Setter Property="FontSize" Value="{StaticResource SmallFontSize}" />
            <Setter Property="Opacity" Value="{StaticResource CommonOpacity}" />
            <Setter Property="TextAlignment" Value="Center" />
            <Setter Property="TextWrapping" Value="Wrap" />
        </Style>
    </UserControl.Resources>

    <Grid x:Name="mCarouselLayoutRoot">
        <Border x:Name="mMediaCardBorder" SnapsToDevicePixels="True">
            <Border.Style>
                <Style TargetType="{x:Type Border}">
                    <Setter Property="Height" Value="360" />
                    <Setter Property="CornerRadius" Value="{StaticResource ExtraSmallCornerRadius}" />
                    <Setter Property="Background">
                        <Setter.Value>
                            <SolidColorBrush Opacity="0.5" Color="{DynamicResource CommonGrayColor}" />
                        </Setter.Value>
                    </Setter>
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding IsFullscreen, ElementName=mProjectImageCarouselControlRoot}" Value="True">
                            <Setter Property="Height" Value="{x:Static sys:Double.NaN}" />
                            <Setter Property="CornerRadius" Value="0" />
                            <Setter Property="Background" Value="Transparent" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </Border.Style>

            <Grid
                x:Name="mMediaRootGrid"
                Margin="{StaticResource CommonTopBottomThickness}"
                ClipToBounds="True"
                SizeChanged="OnMediaRootGridSizeChanged"
                SnapsToDevicePixels="True">

                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Grid
                    x:Name="mMediaOverlayRootGrid"
                    Grid.Row="0"
                    ClipToBounds="True"
                    SnapsToDevicePixels="True">

                    <Grid
                        x:Name="mCarouselImagesHostGrid"
                        ClipToBounds="True"
                        IsHitTestVisible="False">

                        <Image
                            x:Name="mLeftStep3Image"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Opacity="0"
                            RenderOptions.BitmapScalingMode="HighQuality"
                            RenderTransformOrigin="0.5,0.5"
                            Stretch="Uniform"
                            Visibility="Collapsed">
                            <Image.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform ScaleX="1" ScaleY="1" />
                                    <TranslateTransform X="0" Y="0" />
                                </TransformGroup>
                            </Image.RenderTransform>
                        </Image>

                        <Image
                            x:Name="mRightStep3Image"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Opacity="0"
                            RenderOptions.BitmapScalingMode="HighQuality"
                            RenderTransformOrigin="0.5,0.5"
                            Stretch="Uniform"
                            Visibility="Collapsed">
                            <Image.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform ScaleX="1" ScaleY="1" />
                                    <TranslateTransform X="0" Y="0" />
                                </TransformGroup>
                            </Image.RenderTransform>
                        </Image>

                        <Image
                            x:Name="mLeftStep2Image"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Opacity="0"
                            RenderOptions.BitmapScalingMode="HighQuality"
                            RenderTransformOrigin="0.5,0.5"
                            Stretch="Uniform"
                            Visibility="Collapsed">
                            <Image.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform ScaleX="1" ScaleY="1" />
                                    <TranslateTransform X="0" Y="0" />
                                </TransformGroup>
                            </Image.RenderTransform>
                        </Image>

                        <Image
                            x:Name="mRightStep2Image"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Opacity="0"
                            RenderOptions.BitmapScalingMode="HighQuality"
                            RenderTransformOrigin="0.5,0.5"
                            Stretch="Uniform"
                            Visibility="Collapsed">
                            <Image.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform ScaleX="1" ScaleY="1" />
                                    <TranslateTransform X="0" Y="0" />
                                </TransformGroup>
                            </Image.RenderTransform>
                        </Image>

                        <Image
                            x:Name="mLeftStep1Image"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Opacity="0"
                            RenderOptions.BitmapScalingMode="HighQuality"
                            RenderTransformOrigin="0.5,0.5"
                            Stretch="Uniform"
                            Visibility="Collapsed">
                            <Image.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform ScaleX="1" ScaleY="1" />
                                    <TranslateTransform X="0" Y="0" />
                                </TransformGroup>
                            </Image.RenderTransform>
                        </Image>

                        <Image
                            x:Name="mRightStep1Image"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Opacity="0"
                            RenderOptions.BitmapScalingMode="HighQuality"
                            RenderTransformOrigin="0.5,0.5"
                            Stretch="Uniform"
                            Visibility="Collapsed">
                            <Image.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform ScaleX="1" ScaleY="1" />
                                    <TranslateTransform X="0" Y="0" />
                                </TransformGroup>
                            </Image.RenderTransform>
                        </Image>

                        <Image
                            x:Name="mCurrentImageImage"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            Opacity="0"
                            RenderOptions.BitmapScalingMode="HighQuality"
                            RenderTransformOrigin="0.5,0.5"
                            Stretch="Uniform"
                            Visibility="Collapsed">
                            <Image.RenderTransform>
                                <TransformGroup>
                                    <ScaleTransform ScaleX="1" ScaleY="1" />
                                    <TranslateTransform X="0" Y="0" />
                                </TransformGroup>
                            </Image.RenderTransform>
                        </Image>
                    </Grid>

                    <Grid
                        x:Name="mPlaceholderGrid"
                        Panel.ZIndex="40"
                        Visibility="Collapsed">
                        <StackPanel
                            x:Name="mPlaceholderStackPanel"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">

                            <Viewbox
                                x:Name="mPlaceholderIconViewbox"
                                Width="34"
                                Height="34">
                                <Path
                                    x:Name="mPlaceholderIconPath"
                                    Fill="{DynamicResource CommonWhiteBrush}"
                                    Data="M2,5 C2,3.343 3.343,2 5,2 H19 C20.657,2 22,3.343 22,5 V19 C22,20.657 20.657,22 19,22 H5 C3.343,22 2,20.657 2,19 Z M6,7 A2,2 0 1 0 6,3 A2,2 0 1 0 6,7 Z M4,19 H20 V16 L16,12 L12,16 L9,13 Z"
                                    Opacity="{StaticResource LowOpacity}" />
                            </Viewbox>

                            <TextBlock
                                x:Name="mPlaceholderTextBlock"
                                Margin="{StaticResource SmallThickness}"
                                Style="{StaticResource PlaceholderTextBlockStyle}"
                                Text="{Binding PlaceholderText, ElementName=mProjectImageCarouselControlRoot}" />
                        </StackPanel>
                    </Grid>

                    <Grid
                        x:Name="mNavigationOverlayGrid"
                        Panel.ZIndex="50"
                        Visibility="Collapsed">
                        <Grid.Style>
                            <Style TargetType="{x:Type Grid}">
                                <Setter Property="Opacity" Value="0.9" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsMouseOver, ElementName=mMediaRootGrid}" Value="True">
                                        <Setter Property="Opacity" Value="1" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding IsKeyboardFocusWithin, ElementName=mProjectImageCarouselControlRoot}" Value="True">
                                        <Setter Property="Opacity" Value="1" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <Button
                            x:Name="mPreviousButton"
                            Margin="12,0,0,0"
                            HorizontalAlignment="Left"
                            Click="OnPreviousButtonClick"
                            Style="{StaticResource ButtonStyle}">
                            <Path
                                Width="15"
                                Fill="{DynamicResource CommonWhiteBrush}"
                                Data="M17.920015,8.074995 H11.690015 H6.079985 C5.119985,8.074995 4.639985,9.234995 5.319985,9.915005 L10.500015,15.095005 C11.330015,15.925005 12.680015,15.925005 13.510015,15.095005 L15.480015,13.125005 L18.690015,9.915005 C19.360015,9.234995 18.880015,8.074995 17.920015,8.074995 Z"
                                RenderTransformOrigin="0.5,0.5"
                                Stretch="Uniform">
                                <Path.RenderTransform>
                                    <RotateTransform Angle="90" />
                                </Path.RenderTransform>
                            </Path>
                        </Button>

                        <Button
                            x:Name="mNextButton"
                            Grid.Column="2"
                            Margin="0,0,12,0"
                            HorizontalAlignment="Right"
                            Click="OnNextButtonClick"
                            Style="{StaticResource ButtonStyle}">
                            <Path
                                Width="15"
                                Fill="{DynamicResource CommonWhiteBrush}"
                                Data="M17.920015,8.074995 H11.690015 H6.079985 C5.119985,8.074995 4.639985,9.234995 5.319985,9.915005 L10.500015,15.095005 C11.330015,15.925005 12.680015,15.925005 13.510015,15.095005 L15.480015,13.125005 L18.690015,9.915005 C19.360015,9.234995 18.880015,8.074995 17.920015,8.074995 Z"
                                RenderTransformOrigin="0.5,0.5"
                                Stretch="Uniform">
                                <Path.RenderTransform>
                                    <RotateTransform Angle="270" />
                                </Path.RenderTransform>
                            </Path>
                        </Button>
                    </Grid>

                    <Border
                        x:Name="mFocusRingBorder"
                        Panel.ZIndex="60"
                        BorderBrush="{DynamicResource CommonBrush}"
                        BorderThickness="{StaticResource ExtraSmallThickness}"
                        CornerRadius="{Binding CornerRadius, ElementName=mMediaCardBorder}"
                        IsHitTestVisible="False"
                        Opacity="0"
                        SnapsToDevicePixels="True">
                        <Border.Style>
                            <Style TargetType="{x:Type Border}">
                                <Setter Property="Opacity" Value="0" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsKeyboardFocusWithin, ElementName=mProjectImageCarouselControlRoot}" Value="True">
                                        <Setter Property="Opacity" Value="0.9" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>
                    </Border>
                </Grid>

                <Border
                    x:Name="mDotsBackgroundBorder"
                    Grid.Row="1"
                    Margin="0,10,0,6"
                    Padding="10,6"
                    HorizontalAlignment="Center"
                    Background="{DynamicResource CommonDarkerGrayBrush}"
                    BorderBrush="{DynamicResource CommonLightGrayBrush}"
                    BorderThickness="{StaticResource ExtraExtraSmallThickness}"
                    CornerRadius="{StaticResource SmallCornerRadius}"
                    SnapsToDevicePixels="True"
                    Visibility="Collapsed">
                    <ListBox
                        x:Name="mDotsListBox"
                        Background="Transparent"
                        BorderThickness="0"
                        Focusable="False"
                        ItemsSource="{Binding Images, ElementName=mProjectImageCarouselControlRoot}"
                        ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                        ScrollViewer.VerticalScrollBarVisibility="Disabled"
                        SelectedIndex="{Binding SelectedIndex, ElementName=mProjectImageCarouselControlRoot, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel x:Name="mDotsStackPanel" Orientation="Horizontal" />
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                        <ListBox.ItemContainerStyle>
                            <Style BasedOn="{StaticResource DotsListBoxItemStyle}" TargetType="{x:Type ListBoxItem}" />
                        </ListBox.ItemContainerStyle>
                    </ListBox>
                </Border>

                <StackPanel
                    x:Name="mHintStackPanel"
                    Grid.Row="2"
                    Margin="0,0,0,4"
                    HorizontalAlignment="Center"
                    IsHitTestVisible="False"
                    Visibility="Collapsed">
                    <TextBlock
                        x:Name="mHintTextBlock"
                        FontSize="{StaticResource SmallFontSize}"
                        Foreground="{DynamicResource CommonWhiteBrush}"
                        Opacity="{StaticResource CommonOpacity}"
                        TextAlignment="Center"
                        TextWrapping="Wrap" />
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
